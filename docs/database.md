# データベースについて

## データベースの選定

### 前提条件

打鍵の分析を行うことを考えて、1打鍵のデータを1レコードとして保存することが望ましいと考えています。そのため、打鍵数を考えると、1000万~1億個のレコードを保存しても問題ないようなデータベースサービスを選ぶ必要があります。

例えば「さかな」という文章を練習した際には、

| 文字 | かかった時間(ms) |
| ---- | ---------------- |
| s    | 500              |
| a    | 100              |
| k    | 200              |
| a    | 100              |
| n    | 250              |
| a    | 300              |

のようにデータを保存します。これは各文字、あるは連節にかかった時間を計算したいためです。一文字目は初速を含んでいるので検索するときには除外する必要があるでしょう。

---

また、検索機能ではワードを安定打（ミスせずに打ち切った回数）、挑戦回数、KPM中央値などの値で検索する予定なので、この実装についても考えておきたいです。

挑戦回数は、[ワードの練習記録]テーブルのレコード数が該当します。

KPM中央値は、[ワードの練習記録]テーブルにKPMを保存しておけば、計算することができます。SQLで中央値を計算するのは少しややこしそう。PostgreSQLやDuchDBはPERCENTILE_CONTという関数がある。

安定打は、ワードの練習記録テーブルに打ち切ったかどうか、ミスしていないかどうかなどの情報を持たせると計算することができる。ミスしていないレコード数/挑戦回数が、安定打の割合。

### 比較・検討

- Supabase Pro($25/月)
- Cloudflare D1($5/月)
- DuckDB Wasm + OPFS
- SQLite Wasm + OPFS
